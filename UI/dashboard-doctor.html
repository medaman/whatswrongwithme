<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Dashboard</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/style.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>

  <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />

</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="white">
        <div class="sidebar-wrapper">
            <div><img class="logo" src="assets/img/logo.png"></div>
            <ul class="nav">
                <li>
                    <a href="dashboard-doctor.html">
                        <div class="sb-item active">
                            <i class="pe-7s-home"></i>
                            <p>Dashboard</p>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="profile-doctor.html">
                        <div class="sb-item">
                            <i class="pe-7s-user"></i>
                            <p>My Profile</p>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="profile-doctor.html">
                        <div class="sb-item">
                            <i class="pe-7s-paperclip"></i>
                            <p>Upload</p>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="login.html">
                        <div class="sb-item">
                            <i class="pe-7s-back-2"></i>
                            <p>Log Out</p>
                        </div>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">

    <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Dashboard</a>
                </div>

                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-left"></ul>
                    <ul class="nav navbar-nav navbar-right"></ul>
                </div>
            </div>
    </nav>

    <div class="content">
        <div class="container-fluid">

            <div class="row">

                <div class="col-md-6">
                     <p class="welcome-msg">Welcome,<span class="welcome-name"> Dr. Robert Mastey</span>!</p>
                </div>

                <div class="col-md-offset-3 col-md-3">
                    <div class="form-group">
                        <select class="form-control">
                            <option selected disabled>My Patients</option>
                            <option>Christine Parker</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">

                <div class="col-md-4">
                    <div class="card">
                        <div class="header">
                            <h4 class="title">My Patient</h4>
                        </div>

                        <div class="content info">
                            <div class="name-div">
                                <img class="img-circle profile-avatar" src="assets/img/faces/user-avatar.jpg">
                                <h5 class="name">Christine Parker</h5>
                            </div>
                                
                            <div class="table-full-width">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td class="info-title">Date of Birth</td>
                                            <td class="text-right" id="dob">01/23/1980</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="info-title">Email</td>
                                            <td class="text-right" id="email">cparker@example.com</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="info-title">Location</td>
                                            <td class="text-right" id="location">Irvine, California</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td class="info-title">Insurance Provider</td>
                                            <td class="text-right" id="insurance">United Health Care</td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Info Card End -->

                <div class="col-md-8">
                    <div class="card">
                        <div class="row">
                            <div class="col-md-5">
                                 <div class="header">
                                    <h4 class="title">Patient's Heart Rate</h4>
                                </div>
                            </div>

                            <div class="col-md-offset-2 col-md-2">
                                <a class="text-center pull-right btn-purple btn-upload" href="#" id="playSound">Play</a>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group heartrate-dropdown">
                                    <select class="form-control" id="selectSound">
                                        <option selected disabled>Choose Heart Rate</option>
                                        <option id="op1">Heart Rate 1</option>
                                        <option id="op2">Heart Rate 2</option>
                                        <option id="op3">Heart Rate 3</option>
                                        <option id="op4">Heart Rate 4</option>
                                        <option id="op5">Heart Rate 5</option>
                                    </select>
                                </div>

                            </div>
                        </div>

                           
                        <div class="content">
                        <!--
                            <div id="chartHours" class="ct-chart"></div>
                        -->
                            <div id="waveform"></div>
                        </div>
                    </div>
                </div>
                <!-- Heart Rate Card End -->
            </div>
            <!-- First Row Closed -->

            <div class="row">
                <div class="col-md-12">
                    <div class="card ">
                        <div class="header">
                            <h4 class="title">Comments</h4>
                        </div>

                        <div class="content">
                            <div class="chat-box">
                                <div>
                                    <img class="img-circle chat-avatar" src="assets/img/faces/doc-avatar.jpg">
                                    <h5 class="chat-sender">Dr. Robert Mastey</h5>
                                    <p class="chat-time"><i class="ace-icon fa fa-clock-o"></i>1d ago</p>
                                    
                                </div>
                                <div>
                                    <p class="chat-text">Hi, How may I help you?</p>
                                </div>
                            </div>

                            <div class="chat-box">
                                <div>
                                    <img class="img-circle chat-avatar" src="assets/img/faces/user-avatar.jpg">
                                    <h5 class="chat-sender">Christine</h5>
                                    <p class="chat-time"><i class="ace-icon fa fa-clock-o"></i>1d ago</p>
                                    
                                </div>
                                <div>
                                    <p class="chat-text">Hi Doctor, I am having headache since 3 days...</p>
                                </div>
                            </div>

                            <div class="chat-box">
                                <div>
                                    <img class="img-circle chat-avatar" src="assets/img/faces/doc-avatar.jpg">
                                    <h5 class="chat-sender">Dr. Robert Mastey</h5>
                                    <p class="chat-time"><i class="ace-icon fa fa-clock-o"></i>1d ago</p>
                                    
                                </div>
                                <div>
                                    <p class="chat-text">Do you have any other symptoms?</p>
                                </div>
                            </div>

                            <div class="reply">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Reply here">
                                    <span class="input-group-btn">
                                        <button class="btn btn-reply" type="button">Submit</button>
                                    </span>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- Second Row Closed -->
        </div>
    </div>


    <footer class="footer">
        <div class="container-fluid">
            <p class="copyright pull-right">
                &copy; <script>document.write(new Date().getFullYear())</script>
                What's Wrong with Me App
            </p>
        </div>
    </footer>
</div>
</div>


</body>

    <!--   Core JS Files   -->
    <script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
	<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>

	<!--  Charts Plugin -->
	<script src="assets/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="assets/js/bootstrap-notify.js"></script>

    <!--  Google Maps Plugin    -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="assets/js/light-bootstrap-dashboard.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="assets/js/demo.js"></script>

	<script type="text/javascript">
    	$(document).ready(function(){

        	demo.initChartist();

    	});
    </script>
    

    <!-- the follow javascript files are required -->
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
    
        <!-- for Edge/FF/Chrome/Opera/etc. getUserMedia support -->
        <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
        <script src="https://cdn.webrtc-experiment.com/DetectRTC.js"> </script>
    
        <script src="http://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.4.0/wavesurfer.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.4.0/plugin/wavesurfer.spectrogram.min.js"></script>
    
    
        <script>
    
            //create wavesurfer to display a wave file onto the front end html
            //this simple front end assume server returns an array with file name inside
            //frontend makes a ajax request to server and display the wave form of the last file in returned data
    
            var wavesurfer;
    
            //when page load, display the latest wav file.
            $.ajax({
    
                method:"GET",
                url:"/data.json"
    
            }).done(function(data){
    
                //console.log(data);
    
                //var lastIndex = data.length - 1;
                var firstIndex = 0;
    
                wavesurfer = WaveSurfer.create({
    
                    container: "#waveform",
                    waveColor: 'violet',
                    progressColor: 'purple'
    
                })
    
                wavesurfer.load("username/wav/" + data[firstIndex].filename);

                wavesurfer.on("ready", function(){


                $("#playSound").attr("data_value", data[firstIndex].filename);

                $("#playSound").on("click", function(e){

                    console.log("clicked playsound");


                        wavesurfer.play();

                })



                })

                for (var i = 0; i < data.length; i++) {

                    $("#op" + (i+1)).attr("data_value", data[i].filename);

                }


    
                /*
                wavesurfer.on('ready', function () {
                    var spectrogram = Object.create(WaveSurfer.Spectrogram);
                    spectrogram.init({
                        wavesurfer: wavesurfer,
                        container: "#wave-spectrogram",
                        fftSamples: 1024,
                        labels: false
                    });
                });
                */
    
            })
    
            //attach event listener to all the playbutton, when clicked, go to server and get the wave file, load onto frontend page and start playing
            $("#selectSound").on("change",function (e){

                //console.log("selected...", this.selectedOptions[0].attributes[1].nodeValue);

                //console.log($("#selectSound"));
    
                //var fileToPlay = $(this).attr("data_value");
                //console.log(fileToPlay);
                var fileToPlay = this.selectedOptions[0].attributes[1].nodeValue;

                $.ajax({
    
                    method:"GET",
                    url:"/data.json"
    
                }).done(function(data){
    
                    //console.log(data);
    
                    for (var i = 0; i < data.length; i++) {
    
                        var fileInJson = data[i].filename;
    
                        //console.log(fileInJson);
                        
                        if (fileToPlay === fileInJson) {
    
                            wavesurfer.destroy();
    
                            wavesurfer = WaveSurfer.create({
    
                                container: "#waveform",
                                waveColor: 'violet',
                                progressColor: 'purple'
    
                            });
    
                            var fileLocation = data[i].location;
                            var fileName = data[i].filename;
    
                            //console.log(fileLocation, fileName);
    
                            wavesurfer.load("username/wav" + "/" + fileName);
    
                            wavesurfer.on('ready', function () {
    
                                $("#playSound").on("click", function(e){

                                    console.log("clicked playsound");


                                    wavesurfer.play();

                                })

                                //wavesurfer.play();
    
                                /*
                                var spectrogram = Object.create(WaveSurfer.Spectrogram);
                                spectrogram.init({
                                    wavesurfer: wavesurfer,
                                    container: "#wave-spectrogram",
                                    fftSamples: 512,
                                    labels: false
                                });
                                */
    
                            });
    
                        }
    
                    }
    
                })
    
            })
    
        </script>
    
        <script>
    
        //records audio from the microphone, user needs to accept the use of microphone.
        //there is NO check for if user denied microphone permission as of now
    
        var recorder;
        var audioStream;
    
    
        //when clicked on start, start recording
        $("#start").on("click", function(e){
    
            console.log("clicked start");
    
            navigator.mediaDevices.getUserMedia({audio: true, video:false,}).then(function(stream) {
    
                audioStream = stream;
    
                var recordDuration = 5000;
    
                recorder = new StereoAudioRecorder(stream, {
                    sampleRate: 44100,
                    bufferSize: 4096,
                    numberOfAudioChannels: 1
                });
    
                recorder.record();
                console.log("start recording");
    
                setTimeout(function(){
    
                    recorder.stop(function(blob){
    
                        var now = Date.now();
                        var fileName = now + ".wav";
    
                        if(!recorder) return alert('No recording found.');
                    
                        $.ajax({
    
                            type: 'POST',
                            url: '/media',
                            data: blob,
                            processData: false,
                            contentType: false
    
                        }).done(function(data){
    
                            console.log("successfully saved wav file");
                            //jquery 
                            audioStream.stop();
                            location.reload();
    
                        })
    
                    })
    
                }, recordDuration);
    
            }).catch(function(error) {
                
                if(error && error.name === 'ConstraintNotSatisfiedError') {
                    console.log("something bad happened");
                }
    
                errorCallback(error);
                });
    
    
    
        })
    
        //when user clicked on stop, stop recording and post data via ajax to server
        $("#stop").on("click", function(e){
    
            //console.log("clicked stop");
            recorder.stop(function(blob){
    
                var now = Date.now();
                var fileName = now + ".wav";
    
                if(!recorder) return alert('No recording found.');
                
                $.ajax({
    
                    type: 'POST',
                    url: '/media',
                    data: blob,
                    processData: false,
                    contentType: false
    
                }).done(function(data){
    
                    console.log("successfully saved wav file");
                    audioStream.stop();
                    location.reload();
    
                })
    
    
            })
    
        })
    
    
    </script>

</html>
